# ============================================================================
# Cortex Analyst Semantic View - Permian Analytics
# ============================================================================
# Semantic model for natural language queries over SCADA and asset data
# 
# Naming Convention (per SNOWFLAKE_DEPLOYMENT_SCRIPT_GUIDELINES.md):
#   DATABASE: AUTOGL_YIELD_OPTIMIZATION
#   SCHEMA: AUTOGL_YIELD_OPTIMIZATION
#   VIEW_NAME: AUTOGL_YIELD_OPTIMIZATION_ANALYTICS_VIEW
# ============================================================================

name: AUTOGL_YIELD_OPTIMIZATION_ANALYTICS_VIEW
description: >
  Semantic view for analyzing SnowCore and TeraField asset performance,
  production metrics, and operational KPIs across the Permian Basin gathering network.
  Supports natural language queries about production, pressure, downtime, and asset comparisons.

tables:
  - name: SCADA_AGGREGATES
    description: Daily aggregated SCADA metrics by asset
    base_table:
      database: AUTOGL_YIELD_OPTIMIZATION
      schema: AUTOGL_YIELD_OPTIMIZATION
      table: SCADA_AGGREGATES
    
    dimensions:
      - name: asset_id
        description: Unique identifier for the physical asset
        expr: ASSET_ID
        data_type: VARCHAR
        
      - name: record_date
        description: Date of the aggregated readings
        expr: RECORD_DATE
        data_type: DATE
        
      - name: source_system
        description: Origin system - SNOWCORE (modern) or TERAFIELD (legacy acquired)
        expr: SOURCE_SYSTEM
        data_type: VARCHAR
        synonyms:
          - acquisition cohort
          - data source
          - origin
          
      - name: zone
        description: Geographic zone - DELAWARE or MIDLAND basin
        expr: ZONE
        data_type: VARCHAR
        synonyms:
          - basin
          - area
          - region
          
      - name: asset_type
        description: Type of equipment (WELL_PAD, SEPARATOR, COMPRESSOR, etc.)
        expr: ASSET_TYPE
        data_type: VARCHAR
        synonyms:
          - equipment type
          - facility type

    time_dimensions:
      - name: date
        description: Date for time-based analysis
        expr: RECORD_DATE
        data_type: DATE

    measures:
      - name: total_production_bbl
        description: Total oil production in barrels
        expr: SUM(TOTAL_PRODUCTION_BBL)
        data_type: NUMBER
        synonyms:
          - oil production
          - barrels produced
          - output
          
      - name: avg_flow_rate_bopd
        description: Average flow rate in barrels of oil per day
        expr: AVG(AVG_FLOW_RATE_BOPD)
        data_type: NUMBER
        synonyms:
          - flow rate
          - production rate
          - BOPD
          
      - name: avg_gas_flow_mcfd
        description: Average gas flow in thousand cubic feet per day
        expr: AVG(AVG_GAS_FLOW_MCFD)
        data_type: NUMBER
        synonyms:
          - gas flow
          - gas production
          - MCFD
          
      - name: total_gas_mcf
        description: Total gas produced in thousand cubic feet
        expr: SUM(TOTAL_GAS_MCF)
        data_type: NUMBER
        synonyms:
          - gas volume
          - total gas
          
      - name: gas_oil_ratio
        description: Gas-Oil Ratio in standard cubic feet per barrel (SCF/BBL)
        expr: AVG(GAS_OIL_RATIO)
        data_type: NUMBER
        synonyms:
          - GOR
          - gas ratio
          - SCF per BBL
          
      - name: max_pressure_psi
        description: Maximum pressure reading in PSI
        expr: MAX(MAX_PRESSURE_PSI)
        data_type: NUMBER
        synonyms:
          - peak pressure
          - highest pressure
          
      - name: avg_pressure_psi
        description: Average pressure reading in PSI
        expr: AVG(AVG_PRESSURE_PSI)
        data_type: NUMBER
        synonyms:
          - mean pressure
          - pressure
          
      - name: pressure_variance
        description: Variance in pressure readings (indicator of stability)
        expr: AVG(PRESSURE_VARIANCE)
        data_type: NUMBER
        synonyms:
          - pressure fluctuation
          - pressure stability
          
      - name: downtime_hours
        description: Estimated hours of downtime based on missing readings
        expr: SUM(DOWNTIME_HOURS)
        data_type: NUMBER
        synonyms:
          - offline hours
          - outage time
          - unavailability
          
      - name: avg_temperature_f
        description: Average temperature in Fahrenheit
        expr: AVG(AVG_TEMPERATURE_F)
        data_type: NUMBER
        synonyms:
          - temperature
          - temp
          
      - name: reading_count
        description: Number of sensor readings (indicator of data quality)
        expr: SUM(READING_COUNT)
        data_type: NUMBER
        
      - name: asset_count
        description: Count of distinct assets
        expr: COUNT(DISTINCT ASSET_ID)
        data_type: NUMBER

  - name: ASSET_MASTER
    description: Master registry of all physical equipment
    base_table:
      database: AUTOGL_YIELD_OPTIMIZATION
      schema: AUTOGL_YIELD_OPTIMIZATION
      table: ASSET_MASTER
    
    dimensions:
      - name: asset_id
        description: Unique identifier for the physical asset
        expr: ASSET_ID
        data_type: VARCHAR
        
      - name: source_system
        description: Origin system - SNOWCORE or TERAFIELD
        expr: SOURCE_SYSTEM
        data_type: VARCHAR
        
      - name: asset_type
        description: Type of equipment
        expr: ASSET_TYPE
        data_type: VARCHAR
        
      - name: asset_subtype
        description: Subtype of equipment
        expr: ASSET_SUBTYPE
        data_type: VARCHAR
        
      - name: manufacturer
        description: Equipment manufacturer
        expr: MANUFACTURER
        data_type: VARCHAR
        synonyms:
          - vendor
          - make
          
      - name: zone
        description: Geographic zone
        expr: ZONE
        data_type: VARCHAR

    measures:
      - name: max_pressure_rating_psi
        description: Maximum allowable working pressure for the asset
        expr: MAX(MAX_PRESSURE_RATING_PSI)
        data_type: NUMBER
        synonyms:
          - MAWP
          - design pressure
          - pressure limit
          - rated pressure
          
      - name: asset_count
        description: Count of assets
        expr: COUNT(*)
        data_type: NUMBER

  - name: GRAPH_PREDICTIONS
    description: ML model predictions for anomalies and link discovery
    base_table:
      database: AUTOGL_YIELD_OPTIMIZATION
      schema: AUTOGL_YIELD_OPTIMIZATION
      table: GRAPH_PREDICTIONS
    
    dimensions:
      - name: prediction_type
        description: Type of prediction - NODE_ANOMALY or LINK_PREDICTION
        expr: PREDICTION_TYPE
        data_type: VARCHAR
        
      - name: entity_id
        description: Asset ID being predicted
        expr: ENTITY_ID
        data_type: VARCHAR
        
      - name: related_entity_id
        description: Related asset (for link predictions)
        expr: RELATED_ENTITY_ID
        data_type: VARCHAR

    measures:
      - name: anomaly_score
        description: Risk score from ML model (0-1, higher = more risk)
        expr: AVG(SCORE)
        data_type: NUMBER
        synonyms:
          - risk score
          - risk level
          
      - name: max_anomaly_score
        description: Maximum anomaly score
        expr: MAX(SCORE)
        data_type: NUMBER
        
      - name: confidence
        description: Model confidence in the prediction
        expr: AVG(CONFIDENCE)
        data_type: NUMBER
        
      - name: prediction_count
        description: Number of predictions
        expr: COUNT(*)
        data_type: NUMBER

# Sample verified queries for testing
verified_queries:
  - question: "Compare downtime between SnowCore and TeraField assets over the last 7 days"
    sql: |
      SELECT 
        SOURCE_SYSTEM,
        SUM(DOWNTIME_HOURS) AS TOTAL_DOWNTIME_HOURS,
        AVG(DOWNTIME_HOURS) AS AVG_DAILY_DOWNTIME
      FROM SCADA_AGGREGATES
      WHERE RECORD_DATE >= DATEADD(day, -7, CURRENT_DATE())
      GROUP BY SOURCE_SYSTEM
      ORDER BY TOTAL_DOWNTIME_HOURS DESC
      
  - question: "What is the total production by zone?"
    sql: |
      SELECT 
        ZONE,
        SUM(TOTAL_PRODUCTION_BBL) AS TOTAL_PRODUCTION_BBL
      FROM SCADA_AGGREGATES
      GROUP BY ZONE
      ORDER BY TOTAL_PRODUCTION_BBL DESC
      
  - question: "Which assets have the highest pressure readings?"
    sql: |
      SELECT 
        ASSET_ID,
        MAX(MAX_PRESSURE_PSI) AS PEAK_PRESSURE_PSI,
        AVG(AVG_PRESSURE_PSI) AS AVG_PRESSURE_PSI
      FROM SCADA_AGGREGATES
      GROUP BY ASSET_ID
      ORDER BY PEAK_PRESSURE_PSI DESC
      LIMIT 10
      
  - question: "Show me high-risk assets from the ML predictions"
    sql: |
      SELECT 
        ENTITY_ID AS ASSET_ID,
        SCORE AS RISK_SCORE,
        CONFIDENCE,
        EXPLANATION
      FROM GRAPH_PREDICTIONS
      WHERE PREDICTION_TYPE = 'NODE_ANOMALY'
        AND SCORE > 0.5
      ORDER BY SCORE DESC
      
  - question: "What is the average GOR by source system?"
    sql: |
      SELECT 
        SOURCE_SYSTEM,
        ROUND(AVG(GAS_OIL_RATIO), 0) AS AVG_GOR_SCF_BBL,
        ROUND(SUM(TOTAL_GAS_MCF), 0) AS TOTAL_GAS_MCF,
        ROUND(SUM(TOTAL_PRODUCTION_BBL), 0) AS TOTAL_OIL_BBL
      FROM SCADA_AGGREGATES
      GROUP BY SOURCE_SYSTEM
      ORDER BY AVG_GOR_SCF_BBL DESC
